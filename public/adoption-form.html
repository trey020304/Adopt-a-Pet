<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="cache-control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="pragma" content="no-cache" />
  <meta http-equiv="expires" content="0" />
  <link rel="stylesheet" type="text/css" href="css/bootstrap.css" />
  <link rel="stylesheet" type="text/css" href="fonts/font-awesome/css/font-awesome.css" />
  <link rel="stylesheet" type="text/css" href="css/style.css" />
  <link rel="shortcut icon" href="img/favicon.png" type="image/x-icon" />
  <title>Adoption Application</title>
  <style>
    /* Page-specific adjustments */
    .app-container { padding: 80px 20px; max-width: 1100px; margin: 0 auto; }
    .app-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; align-items: start; }
    .animal-summary { background: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 6px 20px rgba(0,0,0,0.06); }
    .animal-summary img { width: 100%; height: auto; border-radius: 8px; object-fit: cover; }
    .animal-meta { margin-top: 12px; }
    .animal-meta h2 { margin: 0 0 6px; }
    .form-panel { background: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 6px 20px rgba(0,0,0,0.06); }
    .form-row { display:flex; gap:12px; }
    .form-actions { display:flex; gap:12px; justify-content:flex-end; margin-top:18px; }

    @media (max-width: 900px) {
      .app-grid { grid-template-columns: 1fr; }
    }

    /* Hide other nav items and keep logo */
    nav#menu .navbar-nav { display: none; }
    /* Align the decorative brown line for this page's section title to the left edge of content */
    .form-panel .section-title { text-align: left; }
    .form-panel .section-title h2::after { left: 0; margin-left: 0; }
  </style>
</head>
<body>
  <!-- Navigation (logo only) -->
  <nav id="menu" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <a class="navbar-brand page-scroll" href="index.html">
          <img src="img/nav-logo.png" alt="logo" class="navbar-logo" /> Adopt a Pet
        </a>
      </div>
    </div>
  </nav>

  <main class="container app-container">
    <div class="app-grid">
      <aside class="animal-summary" id="animalSummary">
        <!-- Animal details will be populated here -->
        <p class="text-muted">Loading animal detailsâ€¦</p>
      </aside>

      <section class="form-panel">
        <div class="section-title"><h2>Adoption Application</h2></div>
        <p>Please complete this form to apply for adoption. Fields marked with * are required.</p>

        <form id="adoptionForm">
          <fieldset>
            <legend>Adopter Information</legend>

            <div class="form-group">
              <label for="fullName">Full name *</label>
              <input id="fullName" name="fullName" class="form-control" type="text" required />
            </div>

            <div class="form-row">
              <div style="flex:1;">
                <label for="phone">Phone number *</label>
                <input id="phone" name="phone" class="form-control" type="tel" required />
              </div>
              <div style="flex:1;">
                <label for="email">Email address *</label>
                <input id="email" name="email" class="form-control" type="email" required />
              </div>
            </div>

            <div class="form-group mt-3">
              <label for="address">Home address *</label>
              <input id="address" name="address" class="form-control" type="text" required />
            </div>

            <div class="form-group mt-3">
              <label for="contactMethod">Preferred contact method *</label>
              <select id="contactMethod" name="contactMethod" class="form-control" required>
                <option value="">Select</option>
                <option value="Email">Email</option>
                <option value="Phone">Phone</option>
              </select>
            </div>
          </fieldset>

          <fieldset class="mt-4">
            <legend>Current Pets</legend>

            <div class="form-group">
              <label>Do you currently have other pets? *</label>
              <div>
                <label class="mr-3"><input type="radio" name="havePets" value="Yes" required /> Yes</label>
                <label><input type="radio" name="havePets" value="No" required /> No</label>
              </div>
            </div>

            <div class="form-group mt-3">
              <label for="vaccinatedStatus">Are current pets vaccinated and spayed/neutered? *</label>
              <select id="vaccinatedStatus" name="vaccinatedStatus" class="form-control" required>
                <option value="">Select</option>
                <option value="Yes">Yes</option>
                <option value="No">No</option>
                <option value="Not applicable">Not applicable</option>
              </select>
            </div>
          </fieldset>

          <fieldset class="mt-4">
            <legend>Pet Care & Experience</legend>

            <div class="form-group">
              <label for="experience">Previous experience with cats/dogs *</label>
              <select id="experience" name="experience" class="form-control" required>
                <option value="">Select</option>
                <option value="Beginner">Beginner</option>
                <option value="Intermediate">Intermediate</option>
                <option value="Experienced">Experienced</option>
              </select>
            </div>

            <div class="form-group mt-3">
              <label for="hoursAlone">How many hours per day the pet would be left alone *</label>
              <input id="hoursAlone" name="hoursAlone" class="form-control" type="number" min="0" required />
            </div>
            <div class="form-group mt-3">
              <label for="dayNight">Where the pet will stay during the day and night *</label>
              <input id="dayNight" name="dayNight" class="form-control" type="text" required />
            </div>
            <div class="form-group mt-3">
              <label for="energy">Preferred energy level *</label>
              <select id="energy" name="energy" class="form-control" required>
                <option value="">Select</option>
                <option value="Low">Low</option>
                <option value="Medium">Medium</option>
                <option value="High">High</option>
              </select>
            </div>
            <div class="form-group mt-3">
              <label for="reason">Reason for wanting to adopt *</label>
              <textarea id="reason" name="reason" class="form-control" rows="4" required></textarea>
            </div>
          </fieldset>

          <fieldset class="mt-4">
            <legend>Commitment & Preparedness</legend>
            
            <div class="form-group">
              <label for="coverCosts">Ability to cover long-term costs (food, vet care, grooming) *</label>
              <select id="coverCosts" name="coverCosts" class="form-control" required>
                <option value="">Select</option>
                <option value="Yes">Yes</option>
                <option value="No">No</option>
              </select>
            </div>
            <div class="form-group mt-3">
              <label for="vetCheckups">Willingness to schedule vet checkups and vaccinations *</label>
              <select id="vetCheckups" name="vetCheckups" class="form-control" required>
                <option value="">Select</option>
                <option value="Yes">Yes</option>
                <option value="No">No</option>
              </select>
            </div>
            <div class="form-group mt-3">
              <label style="display:block;"><input id="agreePolicy" name="agreePolicy" type="checkbox" required /> I agree to the adoption terms & shelter policies *</label>
            </div>
          </fieldset>

          <div class="form-actions">
            <button type="button" class="btn btn-custom" id="backBtn">Back</button>
            <button type="submit" class="btn btn-custom">Submit Application</button>
          </div>
        </form>
      </section>
    </div>
  </main>

  <script type="text/javascript">
    // Helpers
    function getQueryParam(name) {
      const params = new URLSearchParams(window.location.search);
      return params.get(name);
    }

    async function renderAnimalSummary(animalId) {
      const target = document.getElementById('animalSummary');
      
      if (!animalId) {
        target.innerHTML = '<p class="text-muted">No animal selected.</p>';
        return;
      }

      try {
        const { data, error } = await supabase.from('animals').select('*').eq('id', animalId).single();
        
        if (error || !data) {
          target.innerHTML = '<p class="text-muted">Animal not found.</p>';
          return;
        }

        const animal = data;
        const mainImageUrl = animal.main_image || (animal.gallery && animal.gallery[0]) || 'img/sample_adopt/cat 1.jpg';
        const animalType = animal.type || 'Unknown';
        const breed = animal.breed || 'Unknown';
        const age = animal.age || 'Unknown';
        const sex = animal.sex || 'Unknown';
        const size = animal.size || 'Unknown';
        const name = animal.name || 'Unknown';

        target.innerHTML = '<img src="' + mainImageUrl + '" alt="' + name + '" />' +
          '<div class="animal-meta">' +
          '<h2>' + name + '</h2>' +
          '<p><strong>Type:</strong> ' + animalType + '</p>' +
          '<p><strong>Breed:</strong> ' + breed + '</p>' +
          '<p><strong>Age:</strong> ' + age + '</p>' +
          '<p><strong>Sex:</strong> ' + sex + '</p>' +
          '<p><strong>Size:</strong> ' + size + '</p>' +
          '</div>';
      } catch (e) {
        console.error('Error loading animal:', e);
        target.innerHTML = '<p class="text-muted">Error loading animal details.</p>';
      }
    }

    document.addEventListener('DOMContentLoaded', function() {
      const animalId = getQueryParam('animalId');
      renderAnimalSummary(animalId);

      document.getElementById('backBtn').addEventListener('click', function() {
        window.history.back();
      });

      document.getElementById('saveDraft').addEventListener('click', function() {
        alert('Save draft clicked (no backend implemented).');
      });
    });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
  <script type="text/javascript" src="js/supabase-init.js"></script>
  <script type="text/javascript" src="js/adoption-form-logic.js"></script>
</body>
</html>
